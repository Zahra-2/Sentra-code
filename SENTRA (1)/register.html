<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Register - SENTRA</title>
		<link
			rel="stylesheet"
			href="styles.css" />

		<!-- Remove Firebase SDK script tags as we'll import them as modules -->
	</head>
	<body class="register-page">
		<!-- Navbar -->
		<div class="navbar">
			<div class="icon">
				<img
					src="https://github.com/Zahra-2/SENTRA/blob/main/logo.png?raw=true"
					alt="Logo"
					class="logo" />
			</div>
			<div class="menu">
				<ul>
					<li><a href="index.html">HOME</a></li>
					<li><a href="index.html">LOGIN</a></li>
					<li><a href="service.html">SERVICE</a></li>
					<li><a href="coming-soon.html">CONTACT</a></li>
				</ul>
			</div>
		</div>

		<!-- Registration Form -->
		<div class="register-form">
			<h2>Registration</h2>
			<input
				type="text"
				id="name"
				placeholder="Full Name"
				required />
			<input
				type="email"
				id="email"
				placeholder="Email"
				required />
			<input
				type="text"
				id="username"
				placeholder="Username"
				required />
			<input
				type="password"
				id="password"
				placeholder="Password"
				required />

			<div class="terms-container">
				<input
					type="checkbox"
					id="terms"
					required />
				<label
					for="terms"
					class="terms-label">
					You confirm that you have read and agree to our Terms and Conditions
					and Privacy Policy.
				</label>
			</div>

			<div
				id="error-message"
				style="color: red; margin-top: 10px"></div>
			<div
				id="success-message"
				style="color: green; margin-top: 10px"></div>

			<button
				class="btnn"
				id="register-btn">
				Submit
			</button>

			<p class="link">
				Already have an account? <a href="index.html">Login here</a>
			</p>
		</div>

		<script type="module">
			// Import Firebase functions from our config file
import {
    auth,
    db,
    createUserWithEmailAndPassword,
    doc,
    setDoc
} from './firebase-config.js';

// Event listener for the registration button
document.getElementById('register-btn').addEventListener('click', async function () {
    const name = document.getElementById('name').value;
    const email = document.getElementById('email').value;
    const username = document.getElementById('username').value;
    const password = document.getElementById('password').value;
    const termsAccepted = document.getElementById('terms').checked;

    const errorMessage = document.getElementById('error-message');
    const successMessage = document.getElementById('success-message');

    // Clear previous messages
    errorMessage.textContent = '';
    successMessage.textContent = '';

    // Validate input fields
    if (!name || !email || !username || !password) {
        errorMessage.textContent = 'Please fill in all fields';
        return;
    }

    if (!termsAccepted) {
        errorMessage.textContent = 'You must accept the terms and conditions';
        return;
    }

    try {
        // Create a new user with Firebase Authentication
        const userCredential = await createUserWithEmailAndPassword(auth, email, password);
        const user = userCredential.user;
        
        console.log('User created:', user.uid); // Debugging log to check user creation

        // Save user data in Firestore with a default role
        await setDoc(doc(db, 'users', user.uid), {
            fullName: name,
            email: email,
            username: username,
            role: 'user', // Assigning default role
            createdAt: new Date(),
        });

        console.log('User data saved in Firestore'); // Debugging log to check Firestore entry

        successMessage.textContent = 'Registration successful! Redirecting...';

        // Redirect to login page after a short delay
        setTimeout(() => {
            window.location.href = 'index.html';
        }, 2000);
    } catch (error) {
        console.error('Error:', error); // Debugging log to capture errors
        errorMessage.textContent = 'Registration error: ' + error.message;
    }
});
		</script>
	</body>
</html>
