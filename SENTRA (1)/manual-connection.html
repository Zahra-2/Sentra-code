<script type="module">
    import { auth, db, doc, setDoc, onAuthStateChanged } from './firebase-config.js';

    // Check if the user is logged in
    onAuthStateChanged(auth, (user) => {
        if (user) {
            console.log("User is logged in:", user.uid);

            // Add an event listener for form submission
            document.getElementById('add-device-form').addEventListener('submit', async (e) => {
                e.preventDefault(); // Prevent the default form submission

                // Get input values from the form
                const deviceName = document.getElementById('device-name').value;
                const deviceType = document.getElementById('device-type').value;
                const ipAddress = document.getElementById('ip-address').value;

                console.log("Device Name:", deviceName);
                console.log("Device Type:", deviceType);
                console.log("IP Address:", ipAddress);

                try {
                    // Call Shodan API to scan the IP
                    const shodanResponse = await fetch(`https://api.shodan.io/shodan/host/${ipAddress}?key=YOUR_SHODAN_API_KEY`);
                    const shodanData = await shodanResponse.json();

                    console.log("Shodan Data:", shodanData);

                    // Save the scan results to localStorage
                    localStorage.setItem('scanResults', JSON.stringify(shodanData));

                    // Redirect to the results page
                    window.location.href = 'scan-results.html';
                } catch (error) {
                    console.error('Error scanning network: ', error);
                    alert('Failed to scan network: ' + error.message);
                }
            });
        } else {
            console.log("User is not logged in.");
            alert('User not logged in!');
            window.location.href = 'index.html';
        }
    });
</script>
